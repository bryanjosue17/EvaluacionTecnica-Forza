import{a as ne}from"./chunk-S24QMSRQ.js";import{a as re}from"./chunk-76FVMFA2.js";import"./chunk-YBY7T5CB.js";import{a as te}from"./chunk-KKRHNXEK.js";import"./chunk-NUEAGB3S.js";import{b as ie,c as oe}from"./chunk-VQTON5AL.js";import{Bb as W,C as I,Cb as X,D as _,Db as Y,Eb as Z,Fa as B,H as v,Hb as ee,K as s,O as u,Q as c,S as t,T as i,U as p,W as k,X as y,Y as P,da as T,ea as o,fa as C,ga as E,h as S,ha as F,hb as O,ib as q,jb as G,kb as L,lb as Q,ma as D,nb as j,oa as h,ob as H,pa as f,pb as N,qa as R,qb as A,rb as U,ta as M,ua as V,ub as $,v as l,vb as J,w,wa as z,wb as K}from"./chunk-V5BBYBEN.js";import"./chunk-QL7EMX3B.js";import"./chunk-KISXJL5B.js";import"./chunk-HJQ5J22D.js";import"./chunk-HC6MZPB3.js";import"./chunk-763F6G4M.js";import"./chunk-TPFYUTHI.js";import"./chunk-WND7HVWL.js";import"./chunk-Z6EYHB5B.js";import"./chunk-ZRULQIYR.js";import"./chunk-D3ZZG42Y.js";import"./chunk-PNSU6RTT.js";import"./chunk-MM5QLNJM.js";import"./chunk-WTBOK45U.js";import"./chunk-DLDB5PET.js";import"./chunk-JXIEZMHN.js";import"./chunk-IDJ2LIQM.js";import"./chunk-MCRJI3T3.js";import"./chunk-QVBGS5B3.js";import"./chunk-GAXET6VH.js";import"./chunk-6A2YPY52.js";import"./chunk-5W6SV7YT.js";import"./chunk-33E37TNX.js";import"./chunk-3R6QK3UX.js";import"./chunk-WYPTRRHD.js";import"./chunk-4WFVMWDK.js";import"./chunk-MDMZPGPE.js";import"./chunk-B43CU5JX.js";import"./chunk-TQEIIVVC.js";import"./chunk-X7ZBJCWB.js";import"./chunk-LF5XB4YN.js";import{a as b,b as x,g}from"./chunk-LDRJ6W7P.js";function se(n,d){if(n&1&&(t(0,"ion-item")(1,"ion-label")(2,"h3"),o(3),i(),t(4,"p"),o(5),h(6,"currency"),i(),t(7,"p")(8,"strong"),o(9),h(10,"currency"),i()()()()),n&2){let e=d.$implicit;s(3),C(e.name),s(2),F("Cantidad: ",e.qty," x ",f(6,4,e.unitPrice,"GTQ"),""),s(4),E("Subtotal: ",f(10,7,e.qty*e.unitPrice,"GTQ"),"")}}function le(n,d){if(n&1&&(t(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),o(3,"Resumen del Pedido"),i()(),t(4,"ion-card-content")(5,"ion-list"),u(6,se,11,10,"ion-item",9),i(),t(7,"ion-grid")(8,"ion-row")(9,"ion-col",10)(10,"h3"),o(11,"Total:"),i()(),t(12,"ion-col",11)(13,"h3"),o(14),h(15,"currency"),i()()()()()()),n&2){let e=P();s(6),c("ngForOf",e.items),s(8),C(f(15,2,e.total,"GTQ"))}}function ce(n,d){n&1&&(t(0,"div",12),p(1,"ion-spinner",13),t(2,"p"),o(3,"Cargando resumen..."),i()())}function de(n,d){n&1&&p(0,"ion-spinner",14)}var xe=(()=>{class n{constructor(){this.orders=l(re),this.auth=l(te),this.router=l(B),this.toast=l(oe),this.destroyRef=l(v),this.menu=l(ie),this.items=[],this.total=0,this.loading=!0,this.busy=!1}ngOnInit(){if(!this.auth.isLogged()){this.router.navigate(["/login"]);return}this.orders.getCart().pipe(ne(this.destroyRef)).subscribe({next:e=>{this.items=(e.items??[]).map(r=>x(b({},r),{itemId:r.itemId??r.Id})),this.total=e.total??this.items.reduce((r,a)=>r+a.unitPrice*a.qty,0),this.loading=!1},error:()=>{this.loading=!1,this.toast.show("Error al cargar el carrito","danger")}})}openMenu(){return g(this,null,function*(){try{yield customElements.whenDefined("ion-menu"),yield this.menu.enable(!0,"main-menu"),yield this.menu.open("main-menu")}catch(e){console.warn("openMenu() error",e)}})}pay(){return g(this,null,function*(){if(!(this.busy||this.loading)){this.busy=!0;try{let e=yield S(this.orders.checkoutFromCart());if(e?.orderId||e?.order?.header?.Id||e?.order?.id){let r=e.orderId??e.order?.header?.Id??e.order?.id;yield this.toast.show("\xA1Orden creada exitosamente!","success"),this.router.navigate(["/order",r])}else yield this.toast.show("Checkout encolado. Se sincronizar\xE1 al reconectar.","warning"),this.router.navigate(["/dashboard"])}catch{yield this.toast.show("Error al procesar el pago","danger")}finally{this.busy=!1}}})}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=w({type:n,selectors:[["app-checkout"]],standalone:!0,features:[D],decls:23,vars:5,consts:[["loadingTemplate",""],["color","light"],["slot","start"],["fill","clear",3,"click"],["name","menu-outline"],[1,"ion-padding"],[4,"ngIf","ngIfElse"],["expand","block","color","success","size","large",3,"click","disabled"],["name","crescent","slot","start",4,"ngIf"],[4,"ngFor","ngForOf"],["size","6"],["size","6",1,"ion-text-end"],[1,"ion-text-center","ion-padding"],["name","crescent"],["name","crescent","slot","start"]],template:function(r,a){if(r&1){let m=k();t(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-buttons",2)(3,"ion-button",3),y("click",function(){return I(m),_(a.openMenu())}),p(4,"ion-icon",4),i()(),t(5,"ion-title"),o(6,"Finalizar Compra"),i()()(),t(7,"ion-content",5),u(8,le,16,5,"ion-card",6)(9,ce,4,0,"ng-template",null,0,R),t(11,"ion-card")(12,"ion-card-header")(13,"ion-card-title"),o(14,"Informaci\xF3n de Pago"),i()(),t(15,"ion-card-content")(16,"p"),o(17,"Para esta demo, el pago se simula."),i(),t(18,"p"),o(19,"En un entorno real, aqu\xED ir\xEDan los campos de tarjeta de cr\xE9dito, direcci\xF3n de env\xEDo, etc."),i()()(),t(20,"ion-button",7),y("click",function(){return I(m),_(a.pay())}),u(21,de,1,0,"ion-spinner",8),o(22),i()()}if(r&2){let m=T(10);s(8),c("ngIf",!a.loading)("ngIfElse",m),s(12),c("disabled",a.busy||a.loading),s(),c("ngIf",a.busy),s(),E(" ",a.busy?"Procesando Pago...":"Confirmar y Pagar"," ")}},dependencies:[N,U,Y,Z,G,L,Q,j,K,$,J,A,W,H,X,O,q,ee,M,V,z],encapsulation:2})}}return n})();export{xe as CheckoutPage};
