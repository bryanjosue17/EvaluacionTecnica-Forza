import{a as v}from"./chunk-S24QMSRQ.js";import{a as Y}from"./chunk-76FVMFA2.js";import"./chunk-YBY7T5CB.js";import{a as W}from"./chunk-KKRHNXEK.js";import"./chunk-NUEAGB3S.js";import{b as X}from"./chunk-VQTON5AL.js";import{Bb as H,C as p,D as _,Db as N,Eb as U,Fa as Q,Ga as z,Gb as J,H as S,Hb as K,K as a,O as x,Q as s,S as n,T as r,U as m,W as h,X as f,Y as d,da as T,ea as c,fa as I,ga as y,hb as F,ib as D,jb as L,kb as $,ma as V,oa as b,ob as B,pa as C,pb as A,qa as M,qb as G,rb as j,ta as q,ua as O,v as u,w as k,wa as R}from"./chunk-V5BBYBEN.js";import"./chunk-QL7EMX3B.js";import"./chunk-KISXJL5B.js";import"./chunk-HJQ5J22D.js";import"./chunk-HC6MZPB3.js";import"./chunk-763F6G4M.js";import"./chunk-TPFYUTHI.js";import"./chunk-WND7HVWL.js";import"./chunk-Z6EYHB5B.js";import"./chunk-ZRULQIYR.js";import"./chunk-D3ZZG42Y.js";import"./chunk-PNSU6RTT.js";import"./chunk-MM5QLNJM.js";import"./chunk-WTBOK45U.js";import"./chunk-DLDB5PET.js";import"./chunk-JXIEZMHN.js";import"./chunk-IDJ2LIQM.js";import"./chunk-MCRJI3T3.js";import"./chunk-QVBGS5B3.js";import"./chunk-GAXET6VH.js";import"./chunk-6A2YPY52.js";import"./chunk-5W6SV7YT.js";import"./chunk-33E37TNX.js";import"./chunk-3R6QK3UX.js";import"./chunk-WYPTRRHD.js";import"./chunk-4WFVMWDK.js";import"./chunk-MDMZPGPE.js";import"./chunk-B43CU5JX.js";import"./chunk-TQEIIVVC.js";import"./chunk-X7ZBJCWB.js";import"./chunk-LF5XB4YN.js";import{a as P,b as w,g as E}from"./chunk-LDRJ6W7P.js";function Z(o,g){if(o&1){let e=h();n(0,"ion-col",9)(1,"ion-card")(2,"ion-card-content")(3,"ion-grid")(4,"ion-row")(5,"ion-col",10)(6,"h3"),c(7),r(),n(8,"p"),c(9),b(10,"currency"),r(),n(11,"p"),c(12),b(13,"currency"),r()(),n(14,"ion-col",11)(15,"div",12)(16,"ion-button",13),f("click",function(){let i=p(e).$implicit,l=d(2);return _(l.dec(i))}),m(17,"ion-icon",14),r(),n(18,"span",15),c(19),r(),n(20,"ion-button",13),f("click",function(){let i=p(e).$implicit,l=d(2);return _(l.inc(i))}),m(21,"ion-icon",16),r()(),n(22,"ion-button",17),f("click",function(){let i=p(e).$implicit,l=d(2);return _(l.confirmRemove(i))}),m(23,"ion-icon",18),r()()()()()()()}if(o&2){let e,t=g.$implicit,i=d(2);a(7),I((e=t.name)!==null&&e!==void 0?e:"Producto "+t.productId),a(2),y("Precio unitario: ",C(10,7,t.unitPrice,"GTQ"),""),a(3),y("Subtotal: ",C(13,10,t.unitPrice*t.qty,"GTQ"),""),a(4),s("disabled",i.busy),a(3),I(t.qty),a(),s("disabled",i.busy),a(2),s("disabled",i.busy)}}function ee(o,g){if(o&1&&(n(0,"ion-grid")(1,"ion-row"),x(2,Z,24,13,"ion-col",8),r()()),o&2){let e=d();a(2),s("ngForOf",e.items)}}function te(o,g){o&1&&(n(0,"div",19),m(1,"ion-icon",20),n(2,"h2"),c(3,"Tu carrito est\xE1 vac\xEDo"),r(),n(4,"p"),c(5,"Agrega algunos productos para comenzar"),r(),n(6,"ion-button",21),c(7," Ver Productos "),r()())}function ie(o,g){if(o&1){let e=h();n(0,"div",22)(1,"ion-card")(2,"ion-card-content")(3,"h3"),c(4),b(5,"currency"),r(),n(6,"ion-button",23),f("click",function(){p(e);let i=d();return _(i.confirmClear())}),m(7,"ion-icon",24),c(8," Vaciar Carrito "),r(),n(9,"ion-button",25),m(10,"ion-icon",26),c(11," Proceder al Pago "),r()()()()}if(o&2){let e=d();a(4),y("Total: ",C(5,3,e.total,"GTQ"),""),a(2),s("disabled",e.busy),a(3),s("disabled",e.busy)}}var xe=(()=>{class o{constructor(){this.items=[],this.total=0,this.busy=!1,this.orders=u(Y),this.auth=u(W),this.router=u(Q),this.alertCtrl=u(J),this.destroyRef=u(S),this.menu=u(X)}ngOnInit(){if(!this.auth.isLogged()){this.router.navigate(["/login"]);return}let e=()=>this.orders.getCart().pipe(v(this.destroyRef)).subscribe(t=>{this.items=(t.items??[]).map(i=>w(P({},i),{itemId:i.itemId??i.Id})),this.total=t.total??this.items.reduce((i,l)=>i+l.unitPrice*l.qty,0)});e(),this.orders.cartChanged$.pipe(v(this.destroyRef)).subscribe(()=>e())}openMenu(){return E(this,null,function*(){try{yield customElements.whenDefined("ion-menu"),yield this.menu.enable(!0,"main-menu"),yield this.menu.open("main-menu")}catch(e){console.warn("openMenu() error",e)}})}inc(e){this.updateQty(e,e.qty+1)}dec(e){e.qty>1&&this.updateQty(e,e.qty-1)}updateQty(e,t){this.busy=!0,this.orders.updateQty(e.itemId,t).subscribe({complete:()=>this.busy=!1,error:()=>this.busy=!1})}confirmRemove(e){this.alertCtrl.create({header:"Confirmar",message:`\xBFQuieres eliminar ${e.name} del carrito?`,buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",role:"destructive",handler:()=>this.remove(e)}]}).then(t=>t.present())}remove(e){this.busy=!0,this.orders.removeFromCart(e.itemId).subscribe({complete:()=>this.busy=!1,error:()=>this.busy=!1})}confirmClear(){this.alertCtrl.create({header:"Confirmar",message:"\xBFQuieres vaciar todo el carrito?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Vaciar",role:"destructive",handler:()=>this.clear()}]}).then(e=>e.present())}clear(){this.busy=!0,this.orders.clearCart().subscribe({complete:()=>this.busy=!1,error:()=>this.busy=!1})}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=k({type:o,selectors:[["app-cart"]],standalone:!0,features:[V],decls:12,vars:3,consts:[["empty",""],["color","light"],["slot","start"],["fill","clear",3,"click"],["name","menu-outline"],[1,"ion-padding"],[4,"ngIf","ngIfElse"],["class","cart-footer",4,"ngIf"],["size","12",4,"ngFor","ngForOf"],["size","12"],["size","8"],["size","4",1,"ion-text-end"],[1,"qty-controls"],["size","small","fill","outline",3,"click","disabled"],["name","remove"],[1,"qty"],["name","add"],["color","danger","fill","clear","size","small",3,"click","disabled"],["name","trash"],[1,"empty-cart"],["name","basket","size","large","color","medium"],["routerLink","/products","color","primary"],[1,"cart-footer"],["expand","block","color","warning","fill","outline",3,"click","disabled"],["name","trash","slot","start"],["expand","block","color","primary","routerLink","/checkout",3,"disabled"],["name","basket","slot","start"]],template:function(t,i){if(t&1){let l=h();n(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-buttons",2)(3,"ion-button",3),f("click",function(){return p(l),_(i.openMenu())}),m(4,"ion-icon",4),r()(),n(5,"ion-title"),c(6,"Mi Carrito"),r()()(),n(7,"ion-content",5),x(8,ee,3,1,"ion-grid",6)(9,te,8,0,"ng-template",null,0,M)(11,ie,12,6,"div",7),r()}if(t&2){let l=T(10);a(8),s("ngIf",i.items.length)("ngIfElse",l),a(3),s("ngIf",i.items.length)}},dependencies:[A,j,N,U,F,L,$,G,H,B,K,D,q,O,R,z],styles:[".qty-controls[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;margin-bottom:8px}.qty[_ngcontent-%COMP%]{margin:0 8px;font-weight:700}.empty-cart[_ngcontent-%COMP%]{text-align:center;padding:40px 20px}.empty-cart[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-bottom:16px}.cart-footer[_ngcontent-%COMP%]{margin-top:20px}"]})}}return o})();export{xe as CartPage};
